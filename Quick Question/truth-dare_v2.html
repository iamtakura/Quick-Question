<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Truth or Dare - Quick Question</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Bungee&display=swap" rel="stylesheet">
</head>
<body class="truth-dare-mode">
    <div class="disclaimer-modal">
        <div class="disclaimer-content">
            <h2>‚ö†Ô∏è WARNING: ADULTS ONLY ‚ö†Ô∏è</h2>
            <p>This game contains explicit content suitable only for players 18+. By continuing, you confirm you're legally an adult.</p>
            <p><strong>Drinking Rules:</strong> Refuse a truth = 1 shot ü•É | Refuse a dare = 2 shots ü•Éü•É</p>
            <button id="agree-btn">I'M 18+ - LET'S PLAY üî•</button>
        </div>
    </div>

    <header>
        <a href="index.html" class="home-logo">QUICK QUESTION</a>
        <nav>
            <div class="nav-container">
                <a href="game.html" class="nav-item">Strangers</a>
                <a href="friends.html" class="nav-item">Friends</a>
                <a href="dating.html" class="nav-item">Dating</a>
                <a href="relationship.html" class="nav-item">Relationship</a>
                <a href="truth-dare.html" class="nav-item active">Truth or Dare</a>
            </div>
        </nav>
    </header>

    <div class="game-container">
        <div class="tof-selection">
            <h2>Choose Your Fate:</h2>
            <div class="tof-buttons">
                <button id="truth-btn" class="tof-btn">TRUTH üòà</button>
                <button id="dare-btn" class="tof-btn">DARE üëπ</button>
            </div>
        </div>

        <div class="card" id="question-card">
            <div class="card-face card-front">
                <p id="question-text">Will you choose Truth or Dare?</p>
            </div>
        </div>

        <div class="controls">
            <button id="next-btn">NEXT ROUND üî•</button>
            <div class="counter">Round <span id="current-q">1</span>/20</div>
        </div>
    </div>

    <div class="chat-container">
        <div class="chat-box" id="chat-box">
            <!-- Messages will appear here -->
        </div>
        <div class="chat-input-area">
            <input type="text" id="chat-input" placeholder="Type your message...">
            <button id="send-btn">Send</button>
        </div>
    </div>

    <footer>
        <p>¬© 2025 Theo Corp. All Rights Reserved.</p>
    </footer>

    <script>
        // ===== Start of inlined truth-dare.js content (excluding its initChat) =====
        const questions = {
            truth: [
                "What's the most embarrassing thing you've done to impress someone you liked?",
                "Have you ever pretended to orgasm? Why?",
                "What's your biggest sexual turn-off?",
                "What's the wildest place you've had sex?",
                "Have you ever cheated on a partner? What happened?",
                "What's something you're into sexually but afraid to admit?",
                "What's the biggest lie you've told a partner?",
                "Have you ever sent nudes to the wrong person?",
                "What's your guilty pleasure in bed?",
                "What's the most inappropriate time you've gotten turned on?",
                "Describe your most embarrassing sexual experience in vivid detail",
                "What's the most inappropriate place you've masturbated?",
                "Have you ever had a sexual fantasy about someone in this room? Who?",
                "What's the wildest thing you've done to get laid?",
                "Have you ever faked an orgasm with your current partner?",
                "What's your dirtiest sexting mistake?",
                "Describe your most painful sexual experience",
                "What's the most objects you've inserted sexually at once?",
                "Have you ever been caught having sex by a stranger? What happened?",
                "What's your biggest unfulfilled sexual fantasy?",
                "What's the most illegal thing you've done and gotten away with?",
                "Have you ever stolen from a friend? What and why?",
                "What's the most manipulative thing you've done in a relationship?",
                "Have you ever secretly recorded someone without consent? Why?",
                "What's the worst thing you've done while drunk/high?",
                "Have you ever cheated on someone who truly loved you? Details?",
                "What's your biggest regret that would ruin your reputation?",
                "Have you ever pretended to be someone else online to catfish?",
                "What's the most you've ever lied to get sex?",
                "Have you ever revenge porned someone or considered it?"
            ],
            dare: [
                "Let the group choose a sexy outfit from your closet‚Äîyou must wear it for 3 rounds",
                "Make out with the person to your left for 30 seconds",
                "Remove one clothing item and give it to someone else",
                "Whisper your dirtiest fantasy to the person on your right",
                "Let two people blindfold you and feed you something (no questions allowed)",
                "Do your best sexy dance on top of a table",
                "Exchange one clothing item with the person across from you",
                "Let the group create a dating profile for you using your phone",
                "Get spanked by everyone playing (one slap per person)",
                "Show the last text you sent your ex",
                "Let the group wax one part of your body (eyebrow/arm/leg)",
                "Wear your underwear on your head for the next 3 rounds",
                "Let someone draw a dirty picture on your back with permanent marker",
                "Do a handstand against the wall while someone removes your socks with their teeth",
                "Get spanked by everyone playing (one hard slap per person)",
                "Let the group choose an embarrassing tattoo with henna that lasts a week",
                "Swap an article of clothing with the person to your right",
                "Lick the floor in the bar/room you're in",
                "Let someone pour ice down your pants and sit for 1 minute",
                "Do a strip tease until someone tells you to stop", // 20
                "Wear all your clothes backwards for the rest of the game",
                "Let someone style your hair with whatever they find in the kitchen",
                "Get blindfolded and let everyone feed you something mysterious (no veto)",
                "Do 20 pushups with someone sitting on your back",
                "Let the group tie your ankles together for the next 2 rounds",
                "Get a hickey in a visible place from the person to your left",
                "Put an ice cube in your mouth until it melts (no hands)",
                "Let someone draw a mustache on your face with permanent marker",
                "Wear your shoes on your hands for the next 10 minutes",
                "Do a sexy dance with a broom/stick as your partner", // 30
                "Let the group choose one item from your closet you must wear next time you go out",
                "Get a piggyback ride from the heaviest person in the room",
                "Let someone pour a drink down your shirt/pants",
                "Do 10 squats while holding someone's legs",
                "Let the group choose an embarrassing notification sound for your phone",
                "Call your ex and say you still love them (put on speaker)",
                "Post 'I wet the bed last night' on your social media for 1 hour",
                "Let the group send a text to your mom from your phone",
                "Go outside and shout your dirtiest fantasy at the top of your lungs",
                "Call a random number and try to sell them your underwear", // 40
                "Let the group create a dating profile using your real photos",
                "Text your boss 'I quit' then immediately say it was a dare",
                "Go to the nearest store and ask where the condoms are in a baby voice",
                "Let someone post an embarrassing childhood photo on your Instagram",
                "Call a pizza place and order using only sexual innuendos",
                "Send your last nude to the third person in your contacts",
                "Let the group reply to 3 of your Instagram DMs",
                "Go outside and propose to the first person you see",
                "Call your parents and say you're dropping out to become a stripper",
                "Let someone change your Tinder bio to something humiliating", // 50
                "Text your crush describing your dream wedding with them",
                "Post a screenshot of your browser history on your story",
                "Call a restaurant and ask if they serve 'hot beef injections'",
                "Let the group rename a contact in your phone",
                "Send 'I think we should see other people' to your most recent text",
                "Call a friend and confess to a crime you didn't commit",
                "Post a selfie with the caption 'Just got out of prison'",
                "Text your ex 'I still have your underwear'",
                "Change your profile picture to something the group chooses for 24hrs",
                "Send a voice note moaning to the last person you texted" //60
            ]
        };

        let currentRound = 1;
        let currentQuestion = "";
        let currentType = "";

        const truthBtn = document.getElementById('truth-btn');
        const dareBtn = document.getElementById('dare-btn');
        const nextBtnTod = document.getElementById('next-btn'); // Game logic next button
        const questionElementTod = document.getElementById('question-text');
        const counterElementTod = document.getElementById('current-q');
        const cardTod = document.getElementById('question-card');
        const disclaimerModal = document.querySelector('.disclaimer-modal');
        const agreeBtn = document.getElementById('agree-btn');

        function initTruthOrDareGame() {
            if(disclaimerModal) disclaimerModal.style.display = 'flex';

            if(agreeBtn) agreeBtn.addEventListener('click', () => {
                localStorage.setItem('todAgreed', 'true');
                if(disclaimerModal) disclaimerModal.style.display = 'none';
            });

            if(truthBtn) truthBtn.addEventListener('click', () => {
                currentType = 'truth';
                drawQuestionTod();
                toggleTOFButtonsTod(false);
            });

            if(dareBtn) dareBtn.addEventListener('click', () => {
                currentType = 'dare';
                drawQuestionTod();
                toggleTOFButtonsTod(false);
            });

            if(nextBtnTod) nextBtnTod.addEventListener('click', () => {
                if (currentRound >= 20) { // Assuming 20 rounds max
                    endGameTod();
                    return;
                }
                currentRound++;
                if(counterElementTod) counterElementTod.textContent = currentRound; // Update only round number
                resetRoundTod();
            });

            if(cardTod) cardTod.addEventListener('click', () => { // Card flip on click
                cardTod.classList.add('flip');
                setTimeout(() => cardTod.classList.remove('flip'), 300);
            });
        }

        function drawQuestionTod() {
            const pool = questions[currentType];
            if (!pool || pool.length === 0) {
                if(questionElementTod) questionElementTod.textContent = `No more ${currentType}s! Choose another or end game.`;
                return;
            }
            const randomIndex = Math.floor(Math.random() * pool.length);
            currentQuestion = pool[randomIndex];
            // questions[currentType].splice(randomIndex, 1); // Option to remove to avoid repeats

            if(questionElementTod) questionElementTod.textContent = currentQuestion;
            if(cardTod) {
                cardTod.classList.add('flip');
                setTimeout(() => cardTod.classList.remove('flip'), 300);
            }
        }

        function toggleTOFButtonsTod(show) {
            const tofSelection = document.querySelector('.tof-selection');
            if(tofSelection) tofSelection.style.display = show ? 'block' : 'none';
            if(nextBtnTod) nextBtnTod.style.display = show ? 'none' : 'block';
        }

        function resetRoundTod() {
            toggleTOFButtonsTod(true);
            if(questionElementTod) questionElementTod.textContent = "Will you choose Truth or Dare?";
        }

        function endGameTod() {
            if(questionElementTod) questionElementTod.textContent = "Game Over! Want to play again?";
            if(nextBtnTod) nextBtnTod.textContent = "PLAY AGAIN";
            // Resetting for a new game
            currentRound = 1; // Reset round to 1 for the display
             if(counterElementTod) counterElementTod.textContent = currentRound; // Update display
            // If "PLAY AGAIN" is clicked, it will effectively start from round 1 again.
            // The nextBtnTod listener will increment currentRound from 1.
        }

        // Initialize the game logic
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initTruthOrDareGame);
        } else {
            initTruthOrDareGame();
        }
        // ===== End of inlined truth-dare.js content =====
    </script>

    <script>
        // ===== Server-based chat script (from game_v2.html) =====
        const sessionId = "truthDareSessionXYZ"; // Unique session ID
        const sender = "UserTruthDare";       // Example sender

        const chatBox = document.getElementById('chat-box');
        const chatInput = document.getElementById('chat-input');
        const sendButton = document.getElementById('send-btn'); // Chat-specific send button

        function fetchMessages() {
            if (!chatBox) { console.error("Chat box not found for server chat."); return; }
            fetch(`get-messages.php?session_id=${sessionId}`)
                .then(res => {
                    if (!res.ok) return res.text().then(text => { throw new Error(`HTTP error! status: ${res.status}, body: ${text}`); });
                    const contentType = res.headers.get("content-type");
                    if (contentType && contentType.indexOf("application/json") !== -1) return res.json();
                    return res.text().then(text => { throw new Error(`Expected JSON, received ${contentType}. Body: ${text}`); });
                })
                .then(data => {
                    chatBox.innerHTML = '';
                    if (Array.isArray(data)) {
                        data.forEach(msg => {
                            const messageElement = document.createElement('div');
                            messageElement.classList.add('msg');
                            const senderElement = document.createElement('b');
                            senderElement.textContent = (msg.sender || 'Unknown') + ': ';
                            messageElement.appendChild(senderElement);
                            messageElement.appendChild(document.createTextNode(msg.message || ''));
                            chatBox.appendChild(messageElement);
                        });
                    } else if (data) console.warn("Received non-array data from fetchMessages:", data);
                    chatBox.scrollTop = chatBox.scrollHeight;
                })
                .catch(error => {
                    console.error('Error fetching messages:', error);
                    const errorElement = document.createElement('div');
                    errorElement.classList.add('msg', 'error');
                    errorElement.textContent = 'Error loading messages.';
                    if (chatBox) chatBox.appendChild(errorElement);
                    if (chatBox) chatBox.scrollTop = chatBox.scrollHeight;
                });
        }

        function sendMessage() {
            if (!chatInput) { console.error("Chat input not found for server chat."); return; }
            const msg = chatInput.value.trim();
            if (msg === '') return;

            fetch('send-message.php', {
                method: 'POST',
                headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                body: `session_id=${sessionId}&sender=${sender}&message=${encodeURIComponent(msg)}`
            })
            .then(response => {
                if (response.ok) {
                    chatInput.value = '';
                    fetchMessages();
                } else {
                    response.text().then(text => {
                        console.error('Error sending message:', response.status, response.statusText, text);
                        alert(`Error sending message: ${response.statusText} - ${text}`);
                    });
                }
            })
            .catch(error => {
                console.error('Network error sending message:', error);
                alert('Network error sending message: ' + error.message);
            });
        }

        function initServerChatTod() { // Renamed to avoid conflict
            if (sendButton && chatInput && chatBox) {
                sendButton.addEventListener('click', sendMessage);
                chatInput.addEventListener('keypress', function (e) {
                    if (e.key === 'Enter') { e.preventDefault(); sendMessage(); }
                });
                const messagePollingInterval = 1500;
                setInterval(fetchMessages, messagePollingInterval);
                fetchMessages();
            } else {
                console.error('Critical chat UI elements not found for server chat on truth-dare page.');
                const errorDiv = document.createElement('div');
                errorDiv.textContent = 'Server Chat components failed to load on truth-dare page.';
                errorDiv.style.color = 'red'; errorDiv.style.padding = '10px'; errorDiv.style.textAlign = 'center';
                if(document.body) document.body.appendChild(errorDiv);
            }
        }

        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initServerChatTod);
        } else {
            initServerChatTod();
        }
        // ===== End of server-based chat script =====
    </script>
</body>
</html>
